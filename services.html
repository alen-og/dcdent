<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–£—Å–ª—É–≥–∏ –∏ —Ü–µ–Ω—ã - –î–æ–∫—Ç–æ—Ä –î–µ–Ω—Ç</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <header class="header">
        <div class="header-logo">
            <img src="https://static.tildacdn.com/tild3363-3137-4861-b163-386131626365/DrDent_1.png" alt="–î–æ–∫—Ç–æ—Ä –î–µ–Ω—Ç">
            <span class="header-title">–î–æ–∫—Ç–æ—Ä –î–µ–Ω—Ç</span>
        </div>
    </header>

    <main>
        <nav class="nav-tabs">
            <button class="nav-tab" onclick="location.href='index.html'">–ì–ª–∞–≤–Ω–∞—è</button>
            <button class="nav-tab active" onclick="location.href='services.html'">–£—Å–ª—É–≥–∏</button>
            <button class="nav-tab" onclick="location.href='doctors.html'">–í—Ä–∞—á–∏</button>
            <button class="nav-tab" onclick="location.href='appointments.html'">–ó–∞–ø–∏—Å–∏</button>
        </nav>

        <div class="branch-selector" id="category-tabs"></div>
        <div id="services-list"></div>
    </main>

    <div class="fab-container">
        <button class="fab" onclick="toggleContactMenu()">üìû</button>
        <div class="fab-menu" id="contactMenu">
            <a href="tel:+78312660003" class="fab-item">üìû –ü–æ–∑–≤–æ–Ω–∏—Ç—å<small>+7 (831) 266-00-03</small></a>
            <a href="https://wa.me/78312660003" class="fab-item" target="_blank">üí¨ WhatsApp</a>
        </div>
    </div>

    <script src="js/config.js"></script>
    <script src="js/telegram.js"></script>
    <script src="js/app.js"></script>
    <script>
        const categoryId = new URLSearchParams(window.location.search).get('category');

        document.addEventListener('DOMContentLoaded', async () => {
            const categories = await apiGet('/services/categories');
            const tabsContainer = document.getElementById('category-tabs');

            if (categories && tabsContainer) {
                tabsContainer.innerHTML = `
                    <div class="branch-chip ${!categoryId ? 'active' : ''}"
                         onclick="location.href='services.html'">–í—Å–µ</div>
                ` + categories.map(c => `
                    <div class="branch-chip ${categoryId == c.id ? 'active' : ''}"
                         onclick="location.href='services.html?category=${c.id}'">${c.icon} ${c.name}</div>
                `).join('');
            }

            loadServicesPage('services-list', categoryId);
        });

        async function loadServicesPage(containerId, categoryId) {
            const container = document.getElementById(containerId);
            container.innerHTML = '<div class="loader"><div class="spinner"></div></div>';

            let endpoint = '/services';
            if (categoryId) endpoint += `?category=${categoryId}`;

            const services = await apiGet(endpoint);

            if (!services || services.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">ü¶∑</div><p>–£—Å–ª—É–≥–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p></div>';
                return;
            }

            container.innerHTML = services.map(s => `
                <div class="service-card" onclick="selectService(${s.id}, '${s.name.replace(/'/g, "\\'")}', ${s.price || s.price_from})">
                    <div>
                        <div class="service-name">
                            ${s.name}
                            ${s.is_popular ? '<span class="badge badge-popular">–ü–æ–ø—É–ª—è—Ä–Ω–æ–µ</span>' : ''}
                            ${s.is_promo ? '<span class="badge badge-promo">–ê–∫—Ü–∏—è</span>' : ''}
                        </div>
                        <div class="service-duration">${s.duration_min} –º–∏–Ω</div>
                    </div>
                    <div class="service-price ${s.is_promo ? 'promo' : ''}">${s.price_display}</div>
                </div>
            `).join('');
        }

        function selectService(id, name, price) {
            const booking = { service: { id, name, price } };
            localStorage.setItem('booking', JSON.stringify(booking));
            hapticFeedback('medium');
            window.location.href = 'booking/step2.html';
        }
    </script>
</body>
</html>

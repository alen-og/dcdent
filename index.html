<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–î–æ–∫—Ç–æ—Ä –î–µ–Ω—Ç - –ì–ª–∞–≤–Ω–∞—è</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <header class="header">
        <div class="header-logo">
            <img src="https://static.tildacdn.com/tild3363-3137-4861-b163-386131626365/DrDent_1.png" alt="–î–æ–∫—Ç–æ—Ä –î–µ–Ω—Ç">
            <span class="header-title">–î–æ–∫—Ç–æ—Ä –î–µ–Ω—Ç</span>
        </div>
    </header>

    <main>
        <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
        <nav class="nav-tabs">
            <button class="nav-tab active" onclick="location.href='index.html'">–ì–ª–∞–≤–Ω–∞—è</button>
            <button class="nav-tab" onclick="location.href='services.html'">–£—Å–ª—É–≥–∏</button>
            <button class="nav-tab" onclick="location.href='doctors.html'">–í—Ä–∞—á–∏</button>
            <button class="nav-tab" onclick="location.href='appointments.html'">–ó–∞–ø–∏—Å–∏</button>
        </nav>

        <!-- –ë–∞–Ω–Ω–µ—Ä –∑–∞–ø–∏—Å–∏ -->
        <div class="card" style="background: linear-gradient(135deg, var(--primary), var(--primary-light)); color: white;">
            <h2 style="margin-bottom: 8px;">–ó–∞–ø–∏—à–∏—Ç–µ—Å—å –Ω–∞ –ø—Ä–∏—ë–º</h2>
            <p style="opacity: 0.9; margin-bottom: 16px;">–í—ã–±–µ—Ä–∏—Ç–µ —É–¥–æ–±–Ω–æ–µ –≤—Ä–µ–º—è –æ–Ω–ª–∞–π–Ω</p>
            <a href="booking/step1.html" class="btn btn-block" style="background: white; color: var(--primary);">
                ü¶∑ –ó–∞–ø–∏—Å–∞—Ç—å—Å—è
            </a>
        </div>

        <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —É—Å–ª—É–≥ -->
        <div class="section">
            <div class="section-title">–ù–∞—à–∏ —É—Å–ª—É–≥–∏</div>
            <div class="list" id="categories-list">
                <div class="loader"><div class="spinner"></div></div>
            </div>
        </div>

        <!-- –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —É—Å–ª—É–≥–∏ -->
        <div class="section">
            <div class="section-title">–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —É—Å–ª—É–≥–∏</div>
            <div id="popular-services">
                <div class="loader"><div class="spinner"></div></div>
            </div>
        </div>

        <!-- –ù–∞—à–∏ –≤—Ä–∞—á–∏ -->
        <div class="section">
            <div class="section-title">–ù–∞—à–∏ –≤—Ä–∞—á–∏</div>
            <div id="doctors-preview">
                <div class="loader"><div class="spinner"></div></div>
            </div>
            <div style="padding: 0 16px;">
                <a href="doctors.html" class="btn btn-secondary btn-block">–í—Å–µ –≤—Ä–∞—á–∏ ‚Üí</a>
            </div>
        </div>

        <!-- –§–∏–ª–∏–∞–ª—ã -->
        <div class="section">
            <div class="section-title">–ù–∞—à–∏ —Ñ–∏–ª–∏–∞–ª—ã</div>
            <div id="branches-list">
                <div class="loader"><div class="spinner"></div></div>
            </div>
        </div>
    </main>

    <!-- FAB -->
    <div class="fab-container">
        <button class="fab" onclick="toggleContactMenu()">üìû</button>
        <div class="fab-menu" id="contactMenu">
            <a href="tel:+78312660003" class="fab-item">
                üìû –ü–æ–∑–≤–æ–Ω–∏—Ç—å
                <small>+7 (831) 266-00-03</small>
            </a>
            <a href="https://wa.me/78312660003" class="fab-item" target="_blank">
                üí¨ WhatsApp
            </a>
            <a href="https://yandex.ru/maps/-/CDwJjC~r" class="fab-item" target="_blank">
                üìç –ú—ã –Ω–∞ –∫–∞—Ä—Ç–µ
            </a>
        </div>
    </div>

    <script src="js/config.js"></script>
    <script src="js/telegram.js"></script>
    <script src="js/app.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
            const categories = await apiGet('/services/categories');
            const categoriesContainer = document.getElementById('categories-list');
            if (categories && categoriesContainer) {
                categoriesContainer.innerHTML = categories.map(cat => `
                    <a href="services.html?category=${cat.id}" class="list-item" onclick="hapticFeedback('light')">
                        <div class="list-item-icon">${cat.icon}</div>
                        <div class="list-item-content">
                            <div class="list-item-title">${cat.name}</div>
                            <div class="list-item-subtitle">${cat.services_count} —É—Å–ª—É–≥</div>
                        </div>
                        <div class="list-item-arrow">‚Ä∫</div>
                    </a>
                `).join('');
            }

            // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ —É—Å–ª—É–≥–∏
            const popular = await apiGet('/services?popular=true');
            const popularContainer = document.getElementById('popular-services');
            if (popular && popularContainer) {
                popularContainer.innerHTML = popular.slice(0, 5).map(s => `
                    <div class="service-card" onclick="selectService(${s.id}, '${s.name.replace(/'/g, "\\'")}', ${s.price || s.price_from})">
                        <div>
                            <div class="service-name">${s.name}</div>
                            <div class="service-duration">${s.duration_min} –º–∏–Ω</div>
                        </div>
                        <div class="service-price">${s.price_display}</div>
                    </div>
                `).join('');
            }

            // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤—Ä–∞—á–µ–π (–ø—Ä–µ–≤—å—é)
            const doctors = await apiGet('/doctors');
            const doctorsContainer = document.getElementById('doctors-preview');
            if (doctors && doctorsContainer) {
                doctorsContainer.innerHTML = doctors.slice(0, 3).map(d => `
                    <a href="doctor.html?id=${d.id}" class="doctor-card">
                        <img src="${d.photo_url}" alt="${d.name}" class="doctor-photo"
                             onerror="this.src='https://via.placeholder.com/80x80?text=üë®‚Äç‚öïÔ∏è'">
                        <div class="doctor-info">
                            <div class="doctor-name">${d.name}</div>
                            <div class="doctor-specialty">${d.specialty}</div>
                            <div class="doctor-meta">
                                <span class="doctor-rating">‚≠ê ${d.rating}</span>
                            </div>
                        </div>
                    </a>
                `).join('');
            }

            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ñ–∏–ª–∏–∞–ª—ã
            const branches = await apiGet('/branches');
            const branchesContainer = document.getElementById('branches-list');
            if (branches && branchesContainer) {
                branchesContainer.innerHTML = branches.map(b => `
                    <a href="${b.map_link}" target="_blank" class="list-item">
                        <div class="list-item-icon">üìç</div>
                        <div class="list-item-content">
                            <div class="list-item-title">${b.short_name}</div>
                            <div class="list-item-subtitle">${b.address}</div>
                        </div>
                        <div class="list-item-arrow">‚Ä∫</div>
                    </a>
                `).join('');
            }
        });

        function selectService(id, name, price) {
            const booking = { service: { id, name, price } };
            localStorage.setItem('booking', JSON.stringify(booking));
            hapticFeedback('medium');
            window.location.href = 'booking/step2.html';
        }
    </script>
</body>
</html>
